# @schemeless/event-store-adapter-expo-sqlite

Expo SQLite adapter for `@schemeless/event-store`. Designed for React Native applications using the modern `expo-sqlite` API.

## Features

- **Zero ORM dependencies**: Uses `expo-sqlite` directly for optimal performance and smaller bundle size
- **Concurrency Control**: Implements standard `IEventStoreRepo` stream sequence and optimistic concurrency control (OCC) using Exclusive Transactions.
- **Aggregates and Streams**: Full support for `getStreamEvents`, sequential stream reconstruction and querying.
- **Snapshots**: Built-in tables and capabilities for snapshot-based rehydration.

## Installation

You need both this adapter and `expo-sqlite` installed in your project:

```bash
npx expo install expo-sqlite
npm install @schemeless/event-store-adapter-expo-sqlite
# or yar / pnpm
```

## Basic Usage

You should usually initialize the adapter and pass in the database instance generated by Expo SQLite. You can use the `SQLiteProvider` or `openDatabaseAsync`.

```tsx
import { SQLiteProvider, useSQLiteContext } from 'expo-sqlite';
import { ExpoSqliteEventStoreRepo } from '@schemeless/event-store-adapter-expo-sqlite';
import { EventStore } from '@schemeless/event-store';

function App() {
  return (
    <SQLiteProvider databaseName="events.db" onInit={initDatabase}>
      <Main />
    </SQLiteProvider>
  );
}

// In some wrapper or hook
const db = useSQLiteContext();
const repo = new ExpoSqliteEventStoreRepo(db);

const eventStore = new EventStore({
  storeRepo: repo,
  eventFlows: [
    /* Your event flows */
  ],
});

await repo.init(); // Creates necessary tables and indexes
await eventStore.init();
```
